<main class="container mx-auto px-20 py-10 flex flex-col items-start bg-gray-50 min-h-screen">
  <!-- Header -->
  <header class="w-full">
    <h1 class="text-5xl font-extrabold text-[#283c1c]">User Management</h1>
  </header>

  <!-- User Actions and Search -->
  <section class="w-full mt-8">
    <div class="flex flex-col md:flex-row justify-between items-center mb-6">
      <!-- Create New Account Button -->
      <button
        (click)="openModal()"
        class="flex items-center px-5 py-3 bg-[#283c1c] text-white font-semibold rounded-lg shadow-md hover:bg-[#3a532c] transition duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#3a532c]"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6 mr-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 6v6m0 0v6m0-6h6m-6 0H6"
          />
        </svg>
        Create New Account
      </button>

      <!-- Edit and Delete Buttons -->
      <div class="flex gap-3 mt-4 md:mt-0" *ngIf="selectedUsers.length > 0">
        <!-- Edit Button (Visible only when one user is selected) -->
        <button
          *ngIf="selectedUsers.length === 1"
          (click)="editSelectedUser()"
          class="flex items-center px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Edit
        </button>
        <!-- Delete Button -->
        <button
          (click)="deleteSelectedUsers()"
          class="flex items-center px-4 py-2 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
        >
          Delete
        </button>
      </div>
    </div>

    <!-- Search Form -->
    <div class="bg-white rounded-2xl shadow-lg p-8">
      <form class="mb-8">
        <div class="relative">
          <input
            [(ngModel)]="searchQuery"
            (input)="searchUsers()"
            [ngModelOptions]="{ standalone: true }"
            type="text"
            id="searchUser"
            placeholder="Search for a user"
            class="w-full pl-12 pr-4 py-3 text-gray-700 bg-gray-100 border border-transparent rounded-lg focus:border-[#283c1c] focus:bg-white focus:outline-none focus:ring-2 focus:ring-[#283c1c] transition duration-300"
          />
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="absolute top-3 left-4 h-6 w-6 text-gray-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            />
          </svg>
        </div>
      </form>

      <!-- Users Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-[#283c1c]">
            <tr>
              <!-- Select All Checkbox -->
              <th class="px-6 py-4 text-left text-sm font-semibold text-white">
                <input
                  type="checkbox"
                  (change)="toggleSelectAll($event)"
                  class="form-checkbox h-5 w-5 text-white"
                  aria-label="Select All Users"
                />
              </th>
              <!-- Table Headers -->
              <th
                scope="col"
                class="px-6 py-4 text-left text-sm font-semibold text-white uppercase tracking-wide"
              >
                Name
              </th>
              <th
                scope="col"
                class="px-6 py-4 text-left text-sm font-semibold text-white uppercase tracking-wide"
              >
                Username
              </th>
              <th
                scope="col"
                class="px-6 py-4 text-left text-sm font-semibold text-white uppercase tracking-wide"
              >
                Department
              </th>
              <th
                scope="col"
                class="px-6 py-4 text-left text-sm font-semibold text-white uppercase tracking-wide"
              >
                Type
              </th>
              <th
                scope="col"
                class="px-6 py-4 text-left text-sm font-semibold text-white uppercase tracking-wide"
              >
                Status
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr
              *ngFor="let user of paginatedUsers"
              (click)="toggleRowSelection(user)"
              [ngClass]="{ 'bg-gray-100': user.selected }"
              class="cursor-pointer hover:bg-gray-50"
            >
              <!-- User Selection Checkbox -->
              <td class="px-6 py-4 whitespace-nowrap">
                <input
                  type="checkbox"
                  [(ngModel)]="user.selected"
                  (change)="updateSelectedUsers(user)"
                  class="form-checkbox h-5 w-5 text-[#283c1c]"
                  aria-label="Select User"
                />
              </td>
              <!-- User Details -->
              <td class="px-6 py-4 whitespace-nowrap text-gray-800">{{ user.fullName }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-gray-800">{{ user.username }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-gray-800">{{ user.department }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-gray-800">{{ user.type }}</td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="px-3 py-1 inline-flex text-xs font-semibold rounded-full"
                  [ngClass]="{
                    'bg-green-100 text-green-800': user.status === 'Online',
                    'bg-red-100 text-red-800': user.status === 'Offline'
                  }"
                >
                  {{ user.status }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination Controls -->
      <nav
        class="flex items-center justify-center mt-6"
        aria-label="Pagination"
      >
        <ul class="inline-flex items-center -space-x-px">
          <!-- Previous Page Button -->
          <li>
            <button
              (click)="previousPage()"
              [disabled]="currentPage === 1"
              class="px-4 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition duration-300"
              aria-label="Previous Page"
            >
              &laquo; Prev
            </button>
          </li>

          <!-- Page Number Buttons -->
          <li>
            <ng-container *ngFor="let page of [].constructor(totalPages); let i = index">
                <button
                  (click)="goToPage(i + 1)"
                  class="px-4 py-2 leading-tight border border-gray-300 hover:bg-[#283c1c] hover:text-white transition duration-300"
                  [ngClass]="{
                    'bg-[#283c1c] text-white': currentPage === i + 1,
                    'text-gray-700': currentPage !== i + 1
                  }"
                  [attr.aria-label]="'Page ' + (i + 1)"
                >
                  {{ i + 1 }}
                </button>
            </ng-container>
          </li>

          <!-- Next Page Button -->
          <li>
            <button
              (click)="nextPage()"
              [disabled]="currentPage === totalPages"
              class="px-4 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition duration-300"
              aria-label="Next Page"
            >
              Next &raquo;
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </section>

  <!-- Create/Edit Account Modal -->
<app-create-account-modal
  *ngIf="showModal"
  [editingUser]="selectedUser"
  [existingUsers]="users"
  (close)="closeModal()"
  (accountCreated)="onAccountCreated($event)">
</app-create-account-modal>
