<div class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-10 space-y-8">
    
    <!-- Modal Header -->
    <div class="flex items-center justify-between">
      <h2 class="text-3xl font-bold text-gray-900">{{ editingUser ? 'Edit Account' : 'Create New Account' }}</h2>
      <button type="button" (click)="close()" class="text-gray-400 hover:text-gray-600 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
        </svg>
      </button>
    </div>

    <!-- Profile Picture Upload -->
    <div class="flex flex-col items-center justify-center">
      <label for="profile" class="cursor-pointer group relative">
        <div class="w-24 h-24 rounded-full overflow-hidden border-2 border-gray-300 group-hover:border-blue-600 transition">
          <img [src]="newUser.profile ? API.getFileURL(newUser.profile) : 'assets/default.jpg'" alt="Profile Picture" class="w-full h-full object-cover">
        </div>
        <p class="mt-3 text-sm text-gray-500 group-hover:text-blue-600 transition">{{ editingUser ? 'Change Photo' : 'Upload Photo' }}</p>
        <input type="file" id="profile" (change)="onFileSelected($event)" accept="image/*" class="hidden"/>
        <div class="absolute inset-0 bg-blue-600 bg-opacity-20 opacity-0 group-hover:opacity-100 transition"></div>
      </label>
    </div>

    <!-- User Form -->
    <form (ngSubmit)="submitForm()" class="space-y-6">
      
      <!-- Username Field -->   
      <div>
        <label for="username" class="block mb-1 text-sm font-semibold text-gray-700">Username</label>
        <input type="text" id="username" [(ngModel)]="newUser.username" name="username"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 transition"/>
      </div>

      <!-- Full Name Field -->
      <div>
        <label for="fullname" class="block mb-1 text-sm font-semibold text-gray-700">Full Name</label>
        <input type="text" id="fullname" [(ngModel)]="newUser.fullname" name="fullname"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 transition"/>
      </div>

      <!-- Dropdown Field -->
      <div class="mt-4">
        <label for="userRole" class="block mb-1 text-sm font-semibold text-gray-700">User Role</label>
        <select id="userRole" [(ngModel)]="newUser.division_id" name="userRole"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 transition">
          <option value="" disabled selected>Select a role</option>
          <ng-container *ngFor="let division of divisions">
            <option *ngIf="!isSuperAdmin" selected [value]="division.id">{{division.name}}</option>
            <option *ngIf="isSuperAdmin" [value]="division.id">{{division.name}}</option>
          </ng-container>
        </select>
      </div>

      <!-- Password Field -->
      <div>
        <div *ngIf="editingUser && !showPasswordField" class="flex justify-end">
          <button type="button" (click)="togglePasswordField()" class="text-blue-500 font-medium hover:text-blue-700 transition">
            Change Password?
          </button>
        </div>
        <div *ngIf="!editingUser || showPasswordField">
          <label for="password" class="block mb-1 text-sm font-semibold text-gray-700">
            {{ editingUser ? 'New Password' : 'Password' }}
          </label>
          <div class="relative">
            <input [type]="passwordVisible ? 'text' : 'password'" id="password" [(ngModel)]="newUser.password" name="password"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 transition"/>
            <button type="button" (click)="togglePasswordVisibility()" class="absolute inset-y-0 right-0 flex items-center pr-3">
              <svg *ngIf="!passwordVisible" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
              </svg>
              <svg *ngIf="passwordVisible" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd" />
                <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z" />
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="showError" class="text-red-500 text-sm text-center">
        {{ errorMessage }}
      </div>

      <!-- Submit & Cancel Buttons -->
      <div class="flex justify-center space-x-4">
        <button type="button" (click)="close()" class="px-5 py-2 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition">
          Cancel
        </button>
        <button type="submit" class="px-5 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">
          {{ editingUser ? 'Update Account' : 'Create Account' }}
        </button>
      </div>
    </form>
  </div>
</div>
